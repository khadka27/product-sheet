import { PrismaClient } from "@prisma/client";
import { generateSlug } from "../src/lib/utils";

const prisma = new PrismaClient();

async function main() {
  console.log("Start seeding...");

  // Clear existing data
  await prisma.productTag.deleteMany({});
  await prisma.product.deleteMany({});
  await prisma.category.deleteMany({});
  await prisma.tag.deleteMany({});

  // Create categories
  const categories = [
    "Apparel",
    "Footwear",
    "Bags",
    "Gear",
    "Accessories",
    "Electronics",
    "Safety",
  ];

  const categoryRecords = [];
  for (const name of categories) {
    const category = await prisma.category.create({
      data: {
        name,
        slug: generateSlug(name),
      },
    });
    categoryRecords.push(category);
    console.log(`Created category: ${name}`);
  }

  // Create tags
  const tags = [
    "hiking",
    "water-resistant",
    "merino",
    "wool",
    "summer",
    "running",
    "athletic",
    "waterproof",
    "boots",
    "water",
    "insulated",
    "outdoor",
    "camping",
    "tent",
    "fleece",
    "warm",
    "sleeping",
    "trekking",
    "poles",
    "light",
    "led",
    "down",
    "socks",
    "first-aid",
    "safety",
    "emergency",
    "stove",
    "cooking",
    "rain",
    "shell",
    "breathable",
    "carbon-fiber",
    "lightweight",
    "quick-dry",
    "adjustable",
    "4-season",
    "wilderness",
  ];

  const tagRecords = [];
  for (const name of tags) {
    const tag = await prisma.tag.create({
      data: {
        name,
        slug: generateSlug(name),
      },
    });
    tagRecords.push(tag);
    console.log(`Created tag: ${name}`);
  }

  // Sample products data
  const products = [
    {
      sku: "SKU-1001",
      name: "Trail Backpack 30L",
      description:
        "Lightweight pack for day hikes with multiple compartments and water-resistant coating",
      price: 79.99,
      stock: 42,
      category: "Bags",
      tags: ["hiking", "water-resistant", "lightweight"],
    },
    {
      sku: "SKU-1002",
      name: "Merino Tee",
      description: "Soft breathable t-shirt made from premium merino wool",
      price: 39.5,
      stock: 120,
      category: "Apparel",
      tags: ["merino", "wool", "summer", "breathable"],
    },
    {
      sku: "SKU-1003",
      name: "Running Shorts",
      description: "Quick-dry athletic shorts with built-in liner and pockets",
      price: 29.99,
      stock: 85,
      category: "Apparel",
      tags: ["running", "athletic", "summer", "quick-dry"],
    },
    {
      sku: "SKU-1004",
      name: "Hiking Boots",
      description:
        "Waterproof trail boots with excellent grip and ankle support",
      price: 149.95,
      stock: 36,
      category: "Footwear",
      tags: ["hiking", "waterproof", "boots"],
    },
    {
      sku: "SKU-1005",
      name: "Water Bottle",
      description: "Insulated steel bottle 32oz keeps drinks cold for 24 hours",
      price: 24.99,
      stock: 200,
      category: "Accessories",
      tags: ["water", "insulated", "outdoor"],
    },
    {
      sku: "SKU-1006",
      name: "Camping Tent",
      description: "2-person lightweight tent with easy setup and rain fly",
      price: 199.99,
      stock: 15,
      category: "Gear",
      tags: ["camping", "tent", "outdoor", "lightweight"],
    },
    {
      sku: "SKU-1007",
      name: "Fleece Jacket",
      description: "Warm fleece for cool weather with full zip and pockets",
      price: 69.99,
      stock: 75,
      category: "Apparel",
      tags: ["fleece", "warm", "outdoor"],
    },
    {
      sku: "SKU-1008",
      name: "Sleeping Bag",
      description: "4-season rated sleeping bag rated to -10Â°F",
      price: 129.99,
      stock: 28,
      category: "Gear",
      tags: ["sleeping", "camping", "warm", "4-season"],
    },
    {
      sku: "SKU-1009",
      name: "Trekking Poles",
      description: "Adjustable carbon fiber poles with shock absorption",
      price: 89.99,
      stock: 60,
      category: "Accessories",
      tags: ["trekking", "poles", "hiking", "carbon-fiber", "adjustable"],
    },
    {
      sku: "SKU-1010",
      name: "Headlamp",
      description: "LED headlamp with red mode and 400 lumen output",
      price: 34.99,
      stock: 150,
      category: "Electronics",
      tags: ["light", "led", "camping"],
    },
    {
      sku: "SKU-1011",
      name: "Down Jacket",
      description: "Lightweight down insulation jacket packable into pocket",
      price: 179.99,
      stock: 45,
      category: "Apparel",
      tags: ["down", "warm", "light", "lightweight"],
    },
    {
      sku: "SKU-1012",
      name: "Hiking Socks",
      description: "Merino wool hiking socks with cushioned sole",
      price: 16.99,
      stock: 300,
      category: "Apparel",
      tags: ["socks", "merino", "hiking"],
    },
    {
      sku: "SKU-1013",
      name: "First Aid Kit",
      description: "Complete wilderness first aid kit for emergencies",
      price: 49.99,
      stock: 80,
      category: "Safety",
      tags: ["first-aid", "safety", "emergency", "wilderness"],
    },
    {
      sku: "SKU-1014",
      name: "Portable Stove",
      description: "Lightweight camping stove with piezo ignition",
      price: 59.99,
      stock: 95,
      category: "Gear",
      tags: ["stove", "cooking", "camping", "lightweight"],
    },
    {
      sku: "SKU-1015",
      name: "Rain Jacket",
      description: "Waterproof breathable shell with sealed seams",
      price: 119.99,
      stock: 55,
      category: "Apparel",
      tags: ["rain", "waterproof", "shell", "breathable"],
    },
    // Additional products to reach 100+
    {
      sku: "SKU-2001",
      name: "Climbing Harness",
      description: "Adjustable climbing harness with gear loops",
      price: 89.99,
      stock: 32,
      category: "Gear",
      tags: ["climbing", "safety", "adjustable"],
    },
    {
      sku: "SKU-2002",
      name: "Base Layer Top",
      description: "Moisture-wicking long sleeve base layer",
      price: 45.99,
      stock: 90,
      category: "Apparel",
      tags: ["base-layer", "moisture-wicking", "outdoor"],
    },
    {
      sku: "SKU-2003",
      name: "Trail Runners",
      description: "Lightweight trail running shoes with grip sole",
      price: 119.99,
      stock: 65,
      category: "Footwear",
      tags: ["running", "trail", "lightweight"],
    },
    {
      sku: "SKU-2004",
      name: "Daypack 20L",
      description: "Compact daypack for short hikes",
      price: 49.99,
      stock: 78,
      category: "Bags",
      tags: ["hiking", "daypack", "compact"],
    },
    {
      sku: "SKU-2005",
      name: "Camp Chair",
      description: "Portable folding camp chair with cup holder",
      price: 39.99,
      stock: 45,
      category: "Gear",
      tags: ["camping", "chair", "portable"],
    },
  ];

  // Create products with relationships
  for (const productData of products) {
    const category = categoryRecords.find(
      (c) => c.name === productData.category
    );
    const productTags = tagRecords.filter((t) =>
      productData.tags.includes(t.name)
    );

    await prisma.product.create({
      data: {
        sku: productData.sku,
        name: productData.name,
        slug: generateSlug(productData.name),
        description: productData.description,
        price: productData.price,
        stock: productData.stock,
        categoryId: category?.id,
        tags: {
          create: productTags.map((tag) => ({
            tagId: tag.id,
          })),
        },
      },
    });

    console.log(`Created product: ${productData.name}`);
  }

  // Add more varied products to reach 100
  const baseProducts = [
    "Thermal Pants",
    "Windbreaker",
    "Snow Goggles",
    "Gloves",
    "Beanie",
    "Compass",
    "Multi-tool",
    "Rope",
    "Carabiners",
    "Helmet",
    "Binoculars",
    "GPS Device",
    "Solar Charger",
    "Power Bank",
    "Whistle",
    "Emergency Blanket",
    "Fire Starter",
    "Water Filter",
    "Purification Tablets",
    "Cooler",
    "Hammock",
    "Tarp",
    "Gaiters",
    "Ski Socks",
    "Thermal Top",
    "Insulated Pants",
    "Vest",
    "Cap",
    "Sun Hat",
    "Sandals",
    "Approach Shoes",
    "Mountaineering Boots",
    "Crampons",
    "Ice Axe",
    "Snowshoes",
    "Ski Poles",
    "Ski Jacket",
    "Ski Pants",
    "Goggles",
    "Face Mask",
    "Neck Gaiter",
    "Hand Warmers",
    "Foot Warmers",
    "Sleeping Pad",
    "Pillow",
    "Lantern",
    "Flashlight",
    "Battery Pack",
    "Solar Panel",
    "Inverter",
    "Cooktop",
    "Fuel Canister",
    "Cookset",
    "Utensils",
    "Plates",
    "Cups",
    "Bowls",
    "Thermos",
    "Coffee Press",
    "Water Jug",
    "Dry Bag",
    "Stuff Sack",
    "Packing Cubes",
    "Laundry Bag",
    "Toiletry Bag",
    "Quick Shelter",
    "Bivvy",
    "Ground Sheet",
    "Stakes",
    "Guy Lines",
    "Repair Kit",
    "Duct Tape",
    "Paracord",
    "Knife",
    "Saw",
    "Shovel",
    "Hatchet",
    "Machete",
    "Pruning Shears",
    "Work Gloves",
  ];

  const categories2 = [
    "Apparel",
    "Footwear",
    "Gear",
    "Electronics",
    "Accessories",
    "Safety",
  ];
  const tags2 = [
    "outdoor",
    "camping",
    "hiking",
    "winter",
    "summer",
    "waterproof",
    "lightweight",
    "durable",
  ];

  for (let i = 0; i < baseProducts.length; i++) {
    const productName = baseProducts[i];
    const randomCategory =
      categories2[Math.floor(Math.random() * categories2.length)];
    const randomTags = tags2
      .sort(() => 0.5 - Math.random())
      .slice(0, Math.floor(Math.random() * 3) + 1);
    const randomPrice = Math.round((Math.random() * 200 + 10) * 100) / 100;
    const randomStock = Math.floor(Math.random() * 100) + 1;

    const category = categoryRecords.find((c) => c.name === randomCategory);
    const productTags = tagRecords.filter((t) => randomTags.includes(t.name));

    try {
      await prisma.product.create({
        data: {
          sku: `SKU-${3000 + i}`,
          name: productName,
          slug: generateSlug(productName),
          description: `High-quality ${productName.toLowerCase()} for outdoor activities`,
          price: randomPrice,
          stock: randomStock,
          categoryId: category?.id,
          tags: {
            create: productTags.map((tag) => ({
              tagId: tag.id,
            })),
          },
        },
      });
      console.log(`Created additional product: ${productName}`);
    } catch {
      console.log(`Skipped duplicate: ${productName}`);
    }
  }

  console.log("Seeding finished.");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
